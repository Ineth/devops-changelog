import{r as e,c as t,d as i,s,a as l,b as a,e as o,f as n,w as r,g as d,o as u,h as c,i as m,j as p,t as g,k as f,l as h,m as I,n as B,p as b,q as v,u as y,v as k,x as w,P as D}from"./vendor.f8c03a4b.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(i){const s=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((i,a)=>{const o=new URL(e,s);if(self[t].moduleMap[o])return i(self[t].moduleMap[o]);const n=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){a(new Error(`Failed to import: ${e}`)),l(r)},onload(){i(self[t].moduleMap[o]),l(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("/devops-changelog/assets/");const S=(e,t=0,i=!1)=>{let s;return(...l)=>{i&&!s&&e(...l),clearTimeout(s),s=setTimeout((()=>{e(...l)}),t)}};function j(i,s,l=!1){const a=e(i);return t(((e,t)=>({get:()=>(e(),a.value),set:S((e=>{a.value=e,t()}),s,l)})))}var P=i({name:"Menu",props:{searchParams:Object,loading:{type:Boolean,default:!1},fromBuildIdDetails:{type:Object,default:void 0},toBuildIdDetails:{type:Object,default:void 0}},emits:["open-settings","search-workitems","from-build-id-changed","to-build-id-changed"],components:{Menubar:s,InputText:l,Button:a,Card:o,ProgressBar:n},setup(e,t){var i,s;const l=j(null==(i=e.searchParams)?void 0:i.fromBuildId,400),a=j(null==(s=e.searchParams)?void 0:s.toBuildId,400);return r(l,(e=>{t.emit("from-build-id-changed",e)})),r(a,(e=>{t.emit("to-build-id-changed",e)})),{fromBuildId:l,toBuildId:a}}});const T={class:"p-d-flex p-jc-between"},x={class:"p-formgroup-inline"},_={class:"p-field"},M=m("label",{for:"FromBuildID"},"From Build ID",-1),C={class:"p-d-flex p-flex-column p-ml-2"},V={class:"p-field"},O=m("label",{for:"ToBuildId"},"To Build ID",-1),$={key:0,class:"p-grid p-mt-2 p-mb-2"},W=h(" Build: "),z=m("br",null,null,-1),K=h(" Pipeline: "),L=m("br",null,null,-1),N=h(" Repo: "),U=m("div",{class:"p-d-flex p-flex-column p-jc-center p-m-2"},[m("i",{class:"pi pi-angle-double-right",style:{"font-size":"2rem"}})],-1),A=h(" Build: "),R=m("br",null,null,-1),F=h(" Pipeline: "),J=m("br",null,null,-1),E=h(" Repo: ");P.render=function(e,t,i,s,l,a){const o=I("InputText"),n=I("Button"),r=I("Card"),h=I("ProgressBar");return u(),d(r,null,{content:c((()=>[m("div",T,[m("div",x,[m("div",_,[M,m(o,{id:"FromBuildID",type:"text",modelValue:e.fromBuildId,"onUpdate:modelValue":t[1]||(t[1]=t=>e.fromBuildId=t),onKeyup:t[2]||(t[2]=p((t=>e.$emit("search-workitems",{fromBuildId:e.fromBuildId,toBuildId:e.toBuildId})),["enter"]))},null,8,["modelValue"])]),m("div",C,[m("div",V,[O,m(o,{id:"ToBuildId",type:"text",modelValue:e.toBuildId,"onUpdate:modelValue":t[3]||(t[3]=t=>e.toBuildId=t),onKeyup:t[4]||(t[4]=p((t=>e.$emit("search-workitems",{fromBuildId:e.fromBuildId,toBuildId:e.toBuildId})),["enter"]))},null,8,["modelValue"])])]),m(n,{onClick:t[5]||(t[5]=t=>e.$emit("search-workitems",{fromBuildId:e.fromBuildId,toBuildId:e.toBuildId})),icon:"pi pi-search"})]),m("div",null,[m(n,{onClick:t[6]||(t[6]=t=>e.$emit("open-settings")),icon:"pi pi-cog",label:"Settings"})])]),e.fromBuildIdDetails||e.toBuildIdDetails?(u(),d("div",$,[e.fromBuildIdDetails?(u(),d(r,{key:0,class:"detail-card"},{content:c((()=>[W,m("a",{href:e.fromBuildIdDetails.link,target:"_blank"},g(e.fromBuildIdDetails.buildNumber),9,["href"]),z,K,m("a",{href:e.fromBuildIdDetails.pipeline.link,target:"_blank"},g(e.fromBuildIdDetails.pipeline.name),9,["href"]),L,N,m("a",{href:e.fromBuildIdDetails.repo.link,target:"_blank"},g(e.fromBuildIdDetails.repo.name),9,["href"])])),_:1})):f("",!0),U,e.toBuildIdDetails?(u(),d(r,{key:1,class:"detail-card"},{content:c((()=>[A,m("a",{href:e.toBuildIdDetails.link,target:"_blank"},g(e.toBuildIdDetails.buildNumber),9,["href"]),R,F,m("a",{href:e.toBuildIdDetails.pipeline.link,target:"_blank"},g(e.toBuildIdDetails.pipeline.name),9,["href"]),J,E,m("a",{href:e.toBuildIdDetails.repo.link,target:"_blank"},g(e.toBuildIdDetails.repo.name),9,["href"])])),_:1})):f("",!0)])):f("",!0),e.loading?(u(),d(h,{key:1,mode:"indeterminate",style:{height:"0.5em"}})):f("",!0)])),end:c((()=>[])),_:1})};var G=i({name:"Settings",props:{settings:Object},emits:["close-settings","save-settings"],components:{InputText:l,Button:a,Checkbox:B,Card:o},setup:t=>({settings:e(t.settings)})});const q=m("h2",null,"Settings",-1),H={class:"p-fluid p-formgrid p-grid"},X={class:"p-field p-col-12"},Q=m("label",{for:"Organization"},"Organization",-1),Y={class:"p-field p-col-12"},Z=m("label",{for:"Project"},"Project",-1),ee={class:"p-field p-col-12"},te=m("label",{for:"ApiKey"},"API Key",-1),ie={class:"p-field-checkbox p-col-12"},se=m("label",{for:"binary"},"Save in localstorage",-1),le={class:"p-grid p-jc-end"},ae={class:"p-col",style:{display:"flex","justify-content":"flex-end"}};G.render=function(e,t,i,s,l,a){const o=I("InputText"),n=I("Checkbox"),r=I("Button"),p=I("Card");return u(),d(p,null,{title:c((()=>[q])),content:c((()=>[m("div",H,[m("div",X,[Q,m(o,{id:"Organization",type:"text",modelValue:e.settings.organization,"onUpdate:modelValue":t[1]||(t[1]=t=>e.settings.organization=t)},null,8,["modelValue"])]),m("div",Y,[Z,m(o,{id:"Project",type:"text",modelValue:e.settings.project,"onUpdate:modelValue":t[2]||(t[2]=t=>e.settings.project=t)},null,8,["modelValue"])]),m("div",ee,[te,m(o,{id:"ApiKey",type:"text",modelValue:e.settings.apiKey,"onUpdate:modelValue":t[3]||(t[3]=t=>e.settings.apiKey=t)},null,8,["modelValue"])]),m("div",ie,[m(n,{modelValue:e.settings.saveToLocalStorage,"onUpdate:modelValue":t[4]||(t[4]=t=>e.settings.saveToLocalStorage=t),binary:!0},null,8,["modelValue"]),se])])])),footer:c((()=>[m("div",le,[m("div",ae,[m(r,{class:"p-mr-2",label:"Cancel",icon:"pi",onClick:t[5]||(t[5]=t=>e.$emit("close-settings"))}),m(r,{label:"Save",icon:"pi pi-check",onClick:t[6]||(t[6]=t=>e.$emit("save-settings",e.settings))})])])])),_:1})};var oe=i({name:"WorkItemTable",props:{workItems:Array},components:{DataTable:b,Column:v,Card:o}});function ne(e){const t=new Headers;return t.set("Authorization","Basic "+y.encode("user :"+e)),t.set("Content-Type","application/json"),t}oe.render=function(e,t,i,s,l,a){const o=I("Column"),n=I("DataTable"),r=I("Card");return e.workItems?(u(),d(r,{key:0},{content:c((()=>[m(n,{value:e.workItems},{default:c((()=>[m(o,{field:"id",header:"Id",sortable:!0,style:{width:"70px"}},{body:c((e=>[m("a",{class:"p-text-normal",href:e.data.url,target:"_blank"},g(e.data.id),9,["href"])])),_:1}),m(o,{field:"type",header:"Type",sortable:!0,style:{width:"100px"}}),m(o,{field:"title",header:"Title",sortable:!0})])),_:1},8,["value"])])),_:1})):f("",!0)};var re=async(e,t)=>{const i=`https://dev.azure.com/${e.organization}/${e.project}/_apis/build/builds/${t}?api-version=6.1-preview.6`,s=await fetch(i,{method:"GET",headers:ne(e.apiKey)});return 200===s.status?await s.json():null},de=async(e,t,i)=>{const s=await(async(e,t,i)=>{const s=`https://dev.azure.com/${e.organization}/${e.project}/_apis/build/workitems?fromBuildId=${t}&toBuildId=${i}&$top=100&api-version=6.0-preview.2`,l=await fetch(s,{method:"GET",headers:ne(e.apiKey)});return 200===l.status?(await l.json()).value.map((e=>e.id)):null})(e,t,i);if(null===s)throw new Error("Failed to fetch work item ids between builds");return await(async(e,t)=>{const i=`https://dev.azure.com/${e.organization}/${e.project}/_apis/wit/workitemsbatch?api-version=6.0`,s={ids:t,fields:["System.Id","System.Title","System.WorkItemType"]},l=await fetch(i,{method:"POST",headers:ne(e.apiKey),body:JSON.stringify(s)});return 200===l.status?(await l.json()).value.map((e=>({id:e.id,url:e.url.replace("_apis/wit/workItems","Xerius2020/_workitems/edit"),title:e.fields["System.Title"],type:e.fields["System.WorkItemType"]}))):null})(e,s)};var ue=i({name:"App",components:{Menu:P,Settings:G,WorkItemTable:oe,Card:o,Message:k,Button:a},setup:()=>{const t=e(function(){const e=localStorage.getItem("settings");return e?JSON.parse(e):{apiKey:"",organization:"xeriusit",project:"xerius2020",saveToLocalStorage:!1}}()),i=e(function(){const e=localStorage.getItem("searchParams");return e?JSON.parse(e):{fromBuildId:"",toBuildId:""}}()),s=e(void 0),l=e(void 0),a=e(function(){const e=localStorage.getItem("showWelcomeMessage");return!e||JSON.parse(e)}()),o=e(!1);return{settings:t,searchParams:i,fromBuildIdDetails:s,toBuildIdDetails:l,workItemList:e(void 0),settingsVisible:o,errorMessage:e(""),loading:e(!1),showWelcomeMessage:a}},mounted(){var e,t;(null==(e=this.searchParams)?void 0:e.fromBuildId)&&this.getBuildDetails(this.searchParams.fromBuildId,!0),(null==(t=this.searchParams)?void 0:t.toBuildId)&&this.getBuildDetails(this.searchParams.toBuildId,!1)},methods:{closeWelcomeMessage(){var e;this.showWelcomeMessage=!1,e=this.showWelcomeMessage,localStorage.setItem("showWelcomeMessage",JSON.stringify(e))},saveSettings(e){this.settings=e,e.saveToLocalStorage&&function(e){localStorage.setItem("settings",JSON.stringify(e))}(e),this.settingsVisible=!1},async getBuildDetails(e,t){let i;try{const t=await re(this.settings,e);i={link:t._links.web.href,buildNumber:t.buildNumber,pipeline:{name:t.definition.name,link:t.definition.url},repo:{name:t.repository.name,link:t.repository.url}}}catch(s){i=null}t?this.fromBuildIdDetails=i:this.toBuildIdDetails=i},async getWorkItems(e){if(this.errorMessage="",this.searchParams=e,this.settings.apiKey){!function(e){localStorage.setItem("searchParams",JSON.stringify(e))}(e);try{this.loading=!0,this.workItemList=await de(this.settings,this.searchParams.fromBuildId,this.searchParams.toBuildId)}catch(t){this.errorMessage=`Unable to fetch results: ${t}`}finally{this.loading=!1}}else this.errorMessage="No API Key provided, please provide one in the settings."}}});const ce={class:"p-grid"},me={key:0,class:"p-col-12"},pe=h(" Welcome "),ge=h(" This small tool allows you to see DevOps work items that are included between 2 given build ids. "),fe=m("br",null,null,-1),he=m("br",null,null,-1),Ie=m("strong",null,"Note:",-1),Be=h(" Provide your API key in the settings. "),be={class:"p-grid p-jc-end"},ve={class:"p-col",style:{display:"flex","justify-content":"flex-end"}},ye={class:"p-col-12"},ke={key:1,class:"p-col-12"},we={class:"p-d-flex p-jc-center"},De={class:"p-col-12"};ue.render=function(e,t,i,s,l,a){const o=I("Button"),n=I("Card"),r=I("Menu"),p=I("Message"),B=I("Settings"),b=I("WorkItemTable");return u(),d("div",ce,[e.showWelcomeMessage?(u(),d("div",me,[m(n,null,{title:c((()=>[pe])),content:c((()=>[ge,fe,he,Ie,Be])),footer:c((()=>[m("div",be,[m("div",ve,[m(o,{label:"Ok",icon:"pi pi-check",onClick:e.closeWelcomeMessage},null,8,["onClick"])])])])),_:1})])):f("",!0),m("div",ye,[m(r,{searchParams:e.searchParams,loading:e.loading,fromBuildIdDetails:e.fromBuildIdDetails,toBuildIdDetails:e.toBuildIdDetails,onOpenSettings:t[1]||(t[1]=t=>e.settingsVisible=!e.settingsVisible),onSearchWorkitems:t[2]||(t[2]=t=>e.getWorkItems(t)),onFromBuildIdChanged:t[3]||(t[3]=t=>e.getBuildDetails(t,!0)),onToBuildIdChanged:t[4]||(t[4]=t=>e.getBuildDetails(t,!1))},null,8,["searchParams","loading","fromBuildIdDetails","toBuildIdDetails"]),e.errorMessage?(u(),d(p,{key:0,severity:"error",closable:!1},{default:c((()=>[h(g(e.errorMessage),1)])),_:1})):f("",!0)]),e.settingsVisible?(u(),d("div",ke,[m("div",we,[m(B,{settings:e.settings,onCloseSettings:t[5]||(t[5]=t=>e.settingsVisible=!1),onSaveSettings:t[6]||(t[6]=t=>e.saveSettings(t))},null,8,["settings"])])])):f("",!0),m("div",De,[m(b,{"work-items":e.workItemList},null,8,["work-items"])])])};const Se=w(ue);Se.use(D,{ripple:!0}),Se.mount("#app");
